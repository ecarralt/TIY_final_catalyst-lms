<div class="menu_underline_rail">
  <div class= "menu_underline_white_rail"></div>
  <% if @current_user.usertype == "teacher" %>
    <div class= "menu_underline_teacher_students"></div>
  <% elsif @current_user.usertype == "student"%>
    <div class= "menu_underline_student_db"></div>
  <% end %>
</div>

<div class="container">
  <div class="row">
    <div class="col-sm-8 col-sm-offset-2">
      <h1 class= "students_title">Students</h1>
    </div>
  </div>
  <div class="row">
    <div class="col-sm-2">
    </div>
    <div class="col-sm-8">
      <% @students.each do |student| %>
        <div class="well student_content">
          <h3 class="name"><%= student.full_name %></h3>



          <% @subm_arecords =[]
          @assignments_all = Assignment.all.where(released: "1").order(assignment_number: :asc)
          @assignments_all.each do |assignment|
            # ELIMINATED CASE: 1) if there are no records for this assignment, do not add assignment to student assingments
            #2)for this assignment, if there is no record for this user, do not add assignment to student lessons
            if assignment.assignmentrecords.find_by(user_id: student.id) == nil
                #skip assignment
            else
                  ##grab all arecords for this user and lesson, pick the latest one, and add it to the list
                  all_user_arecords = assignment.assignmentrecords.order(created_at: :asc).select{|record| record.user_id == student.id}
                  if all_user_arecords != nil
                    # && all_user_arecords.last.score != nil
                    @subm_arecords << all_user_arecords.last
                  end
            end
          end
         %>




          <p>
            <strong>Assignments completed: </strong> <%= @subm_arecords.count %> out of <%= @assignments.count %>
          </p>
          <p>
            <strong>Lessons completed: </strong> <%= student.lessonrecords.count %> out of <%= @lessons.count %>
          </p>
          <small class= "timestamp">
            enrrolled since: <%= student.created_at.to_formatted_s(:short)%>
          </small>
            <%= link_to "View", student_path(id: student.id) %>
        </div>
      <%end %>
    </div>
    <div class="col-sm-2">
      <div class="by_student_btn">
        <%= link_to "Grade Assignments", arecords_path, class: "btn btn-success" %>
      </div>
      <div class="pr_btn">
        <%= link_to "Create Progress Report", new_pr_path, class: "btn btn-primary" %>
      </div>
    </div>
  </div>
</div>
